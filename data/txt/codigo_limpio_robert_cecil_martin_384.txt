stringbuffer html = new stringbuffer(“<hr”); if(size > 0) html.append(“ size=\“”).append(size + 1).append(“\””); html.append(“>”); return html.tostring(); } si lo analiza, verá lo que sucede. esta función crea la etiqueta html que traza una regla horizontal por la página. la altura de la regla se especifica en la variable size . fíjese otra vez en el código. este método mezcla al menos dos niveles de abstracción. el primero es la noción de que una regla horizontal tiene un tamaño. el segundo es la sintaxis de la propia etiqueta hr . el código proviene del módulo hrulewidget de fitnesse. este módulo detecta una fila de cuatro o más guiones y la convierte en la correspondiente etiqueta hr . cuantos más guiones haya, mayor será el tamaño. a continuación le muestro la refactorización del código. he cambiado el nombre del campo size para reflejar su verdadero cometido. contenía el número de guiones adicionales. public string render() throws exception { htmltag hr = new htmltag(“hr”); if (extradashes > 0) hr.addattribute(“size”, hrsize(extradashes)); return hr.html(); } private string hrsize(int height) { int hrsize = height + 1; return string.format(“%d”, hrsize); } este cambio separa correctamente los dos niveles de abstracción. la función render simplemente crea una etiqueta hr sin tener que saber nada sobre su sintaxis html. el módulo htmltag se encarga de los problemas sintácticos. de hecho, al realizar este cambio detecté un sutil error. el código original no incluía la barra final en la etiqueta hr , como haría el estándar xhtml (es decir, generaba <hr> en lugar de <hr/> ). el módulo htmltag se había modificado hace tiempo para ajustarlo a xhtml. 385